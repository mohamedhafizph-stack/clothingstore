<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta charset="UTF-8">
    <title>Wearify Admin - Manage Stock</title>
    <style>
        :root {
            --bg-dark: #000000;
            --bg-card: #0d0d0d;
            --border: #1a1a1a;
            --text-main: #ffffff;
            --text-muted: #888888;
            --accent: #ffffff; 
            --danger: #ff4d4d;
            --warning: #ffa500;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-dark); color: var(--text-main); padding: 60px 20px; }

        .container { max-width: 850px; margin: 0 auto; }
        
        .header { 
            display: flex; justify-content: space-between; align-items: flex-end; 
            margin-bottom: 40px; border-bottom: 1px solid var(--border); padding-bottom: 20px;
        }
        .header h1 { font-weight: 900; text-transform: uppercase; letter-spacing: -1px; }

        .btn-back { color: var(--text-muted); text-decoration: none; font-size: 12px; text-transform: uppercase; transition: 0.3s; }
        .btn-back:hover { color: #fff; }

        /* Product Info Card */
        .product-brief {
            background: var(--bg-card); border: 1px solid var(--border);
            padding: 24px; border-radius: 4px; display: flex; align-items: center; gap: 25px; margin-bottom: 40px;
        }
        .product-brief img { width: 90px; height: 90px; object-fit: cover; border: 1px solid var(--border); }

        /* Stock Table */
        h3 { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 50px; }
        th { text-align: left; padding: 15px; font-size: 11px; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        td { padding: 18px 15px; border-bottom: 1px solid var(--border); font-size: 14px; }

        /* Stock status colors */
        .low-stock { color: var(--warning); font-weight: bold; font-size: 11px; text-transform: uppercase; margin-left: 8px; }

        /* Action Buttons */
        .action-group { display: flex; gap: 15px; align-items: center; }
        .btn-edit { color: #fff; text-decoration: none; font-size: 12px; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 2px; cursor: pointer; background: none; border: none; }
        .btn-edit:hover { border-color: #fff; }
        .btn-delete { color: var(--danger); background: none; border: none; cursor: pointer; font-size: 12px; text-transform: uppercase; }
        .btn-delete:hover { text-decoration: underline; }

        /* Form Styling */
        .add-stock-form { background: var(--bg-card); padding: 30px; border: 1px solid var(--border); border-radius: 4px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 20px; align-items: flex-end; }
        
        label { font-size: 10px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; display: block; }
        input, select { background: #111; border: 1px solid var(--border); padding: 12px; color: #fff; border-radius: 2px; outline: none; }
        input:focus { border-color: #444; }

        .btn-add { background: var(--accent); color: #000; border: none; padding: 13px 25px; font-weight: 800; text-transform: uppercase; font-size: 12px; cursor: pointer; }
        /* Customizing Swal to match Wearify Theme */
.swal2-popup {
    border: 1px solid #1a1a1a !important;
    border-radius: 0 !important; /* Streetwear sharp edges */
}

.swal2-styled.swal2-confirm {
    background-color: #ffffff !important;
    color: #000 !important;
    font-weight: 800 !important;
    text-transform: uppercase !important;
    font-size: 12px !important;
}

.swal2-input {
    background-color: #000 !important;
    color: #fff !important;
    border: 1px solid #333 !important;
}
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Manage Stock</h1>
            <a href="/admin/products" class="btn-back">‚Üê Back to Products</a>
        </div>

        <div class="product-brief">
            <img src="<%= product.images[0] %>" alt="">
            <div>
                <h2 style="text-transform: uppercase; letter-spacing: -0.5px;"><%= product.name %></h2>
                <p style="color: var(--text-muted); font-size: 13px; margin-top: 5px;">
                    Category: <%= product.category %> | Price: $<%= product.price %>
                </p>
            </div>
        </div>

        <h3>Current Inventory</h3>
        <table>
            <thead>
                <tr>
                    <th>Size</th>
                    <th>Quantity</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% if (product.variants && product.variants.length > 0) { %>
                    <% product.variants.forEach(variant => { %>
                        <tr>
                            <td><strong><%= variant.size %></strong></td>
                            <td>
                                <%= variant.stock %> units
                                <% if(variant.stock < 5) { %>
                                    <span class="low-stock">! Low Stock</span>
                                <% } %>
                            </td>
                            <td>
                                <div class="action-group">
                                    <button class="btn-edit" onclick="editStock('<%= variant._id %>', '<%= variant.stock %>')">Edit</button>
                                    
                                    <form action="/admin/products/stock-delete/<%= product._id %>/<%= variant._id %>?_method=PATCH" method="POST" style="display:inline;">
                                        <button type="submit" class="btn-delete" onclick="return confirm('Remove this variant?')">Remove</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="3" style="text-align: center; color: var(--text-muted); padding: 30px;">Inventory is empty.</td></tr>
                <% } %>
            </tbody>
        </table>

        <div class="add-stock-form">
            <h3>Add New Size/Stock</h3>
            <form action="/admin/products/manage-stock/<%= product._id %>" method="POST">
                <div class="form-row">
                    <div>
                        <label>Size</label>
                        <select name="size" required style="width: 100%;">
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>
                    <div>
                        <label>Quantity</label>
                        <input type="number" name="stock" placeholder="0" min="0" required style="width: 100%;">
                    </div>
                    <button type="submit" class="btn-add">Add Stock</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function editStock(variantId, currentStock) {
    const { value: newStock } = await Swal.fire({
        title: 'UPDATE STOCK',
        input: 'number',
        inputLabel: 'Enter new quantity for this size',
        inputValue: currentStock,
        showCancelButton: true,
        confirmButtonText: 'SAVE',
        confirmButtonColor: '#1a1a1a', // Matching your dark theme
        background: '#0d0d0d',
        color: '#ffffff',
        inputAttributes: {
            min: 0,
            step: 1
        },
        inputValidator: (value) => {
            if (!value || value < 0) {
                return 'Please enter a valid quantity!'
            }
        }
    });

    if (newStock) {
        // Create dynamic form to submit PATCH request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/products/stock-update/<%= product._id %>/${variantId}?_method=PATCH`;

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'stock';
        input.value = newStock;

        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }
}
    </script>
    
</body>
</html>